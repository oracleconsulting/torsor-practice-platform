<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resend Email Debug Tool</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a2b4a 0%, #2d4a7c 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    
    .header {
      background: #ff6b35;
      color: white;
      padding: 30px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }
    
    .content {
      padding: 30px;
    }
    
    .section {
      background: #f5f5f5;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .section h2 {
      font-size: 20px;
      margin-bottom: 15px;
      color: #1a2b4a;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 5px;
      color: #333;
    }
    
    input, textarea {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
    }
    
    input:focus, textarea:focus {
      outline: none;
      border-color: #ff6b35;
    }
    
    button {
      background: #ff6b35;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    button:hover {
      background: #e55a28;
    }
    
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .status {
      padding: 15px;
      border-radius: 6px;
      margin-top: 15px;
      font-weight: 500;
    }
    
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    .code {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      overflow-x: auto;
      white-space: pre;
      margin-top: 10px;
    }
    
    .checklist {
      list-style: none;
    }
    
    .checklist li {
      padding: 10px;
      margin-bottom: 8px;
      background: white;
      border-radius: 6px;
      border-left: 4px solid #ff6b35;
    }
    
    .checklist li::before {
      content: '‚òê ';
      font-size: 18px;
      margin-right: 8px;
    }
    
    .checklist li.checked::before {
      content: '‚úì ';
      color: #28a745;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üìß Resend Email Debug Tool</h1>
      <p>Test your Resend configuration directly</p>
    </div>
    
    <div class="content">
      <!-- Step 1: Configuration Check -->
      <div class="section">
        <h2>Step 1: Configuration Check</h2>
        <p style="margin-bottom: 15px;">Enter your Resend API key to test the configuration:</p>
        
        <div class="form-group">
          <label for="apiKey">Resend API Key *</label>
          <input 
            type="text" 
            id="apiKey" 
            placeholder="re_gNeRqnEt_MxFb413pA2FZKFsCLD1XeBGC"
            value="re_gNeRqnEt_MxFb413pA2FZKFsCLD1XeBGC"
          >
        </div>
        
        <div class="form-group">
          <label for="fromEmail">From Email *</label>
          <input 
            type="email" 
            id="fromEmail" 
            placeholder="onboarding@resend.dev"
            value="onboarding@resend.dev"
          >
          <small style="color: #666; display: block; margin-top: 5px;">
            Use <code>onboarding@resend.dev</code> for testing (no domain verification needed)
          </small>
        </div>
        
        <button onclick="checkConfig()">Check Configuration</button>
        <div id="configStatus"></div>
      </div>
      
      <!-- Step 2: Send Test Email -->
      <div class="section">
        <h2>Step 2: Send Test Email</h2>
        <p style="margin-bottom: 15px;">Send a test invitation email:</p>
        
        <div class="form-group">
          <label for="toEmail">Your Email Address *</label>
          <input 
            type="email" 
            id="toEmail" 
            placeholder="jhoward@rpgcc.co.uk"
          >
        </div>
        
        <div class="form-group">
          <label for="toName">Your Name</label>
          <input 
            type="text" 
            id="toName" 
            placeholder="James Howard"
            value="James Howard"
          >
        </div>
        
        <button onclick="sendTestEmail()" id="sendBtn">Send Test Email</button>
        <div id="sendStatus"></div>
      </div>
      
      <!-- Step 3: Railway Setup -->
      <div class="section">
        <h2>Step 3: Railway Environment Variables</h2>
        <p style="margin-bottom: 15px;">
          Copy these environment variables to your Railway project:
        </p>
        
        <div class="code">VITE_RESEND_API_KEY=re_gNeRqnEt_MxFb413pA2FZKFsCLD1XeBGC
VITE_FROM_EMAIL=onboarding@resend.dev
VITE_FROM_NAME=RPGCC Team Portal</div>
        
        <button onclick="copyToClipboard()" style="margin-top: 15px;">
          Copy to Clipboard
        </button>
        
        <div style="margin-top: 20px;">
          <p><strong>Steps to add to Railway:</strong></p>
          <ul class="checklist" style="margin-top: 10px;">
            <li>Go to Railway Dashboard ‚Üí Your Project</li>
            <li>Click on "Variables" tab</li>
            <li>Add the three variables above</li>
            <li>Click "Deploy" to redeploy with new variables</li>
            <li>Wait for deployment to complete (~2 min)</li>
            <li>Test invitation system in your app</li>
          </ul>
        </div>
      </div>
      
      <!-- Step 4: Troubleshooting -->
      <div class="section">
        <h2>Step 4: Common Issues</h2>
        
        <div style="background: white; padding: 15px; border-radius: 6px; margin-bottom: 10px;">
          <strong>‚ùå "Email not configured" warning in app</strong>
          <p style="margin-top: 5px; color: #666;">
            <strong>Cause:</strong> Frontend can't access API key<br>
            <strong>Fix:</strong> Make sure you're using <code>VITE_RESEND_API_KEY</code> (with VITE_ prefix) and redeploy
          </p>
        </div>
        
        <div style="background: white; padding: 15px; border-radius: 6px; margin-bottom: 10px;">
          <strong>‚ùå "Resend error: 403" in console</strong>
          <p style="margin-top: 5px; color: #666;">
            <strong>Cause:</strong> Domain not verified or invalid API key<br>
            <strong>Fix:</strong> Use <code>onboarding@resend.dev</code> as from email (no verification needed)
          </p>
        </div>
        
        <div style="background: white; padding: 15px; border-radius: 6px; margin-bottom: 10px;">
          <strong>‚ùå Email sent but not received</strong>
          <p style="margin-top: 5px; color: #666;">
            <strong>Cause:</strong> Email in spam or wrong email address<br>
            <strong>Fix:</strong> Check spam folder, verify email address, check Resend logs
          </p>
        </div>
        
        <div style="background: white; padding: 15px; border-radius: 6px;">
          <strong>‚ùå Changes not taking effect</strong>
          <p style="margin-top: 5px; color: #666;">
            <strong>Cause:</strong> Railway hasn't redeployed with new variables<br>
            <strong>Fix:</strong> Force redeploy in Railway, clear browser cache, hard refresh (Cmd+Shift+R)
          </p>
        </div>
      </div>
      
      <!-- Resend Dashboard Links -->
      <div class="section">
        <h2>üìä Resend Dashboard</h2>
        <ul style="list-style: none;">
          <li style="margin-bottom: 8px;">
            <a href="https://resend.com/emails" target="_blank" style="color: #ff6b35; font-weight: 600;">
              üìß Sent Emails
            </a> - See all emails sent (including failures)
          </li>
          <li style="margin-bottom: 8px;">
            <a href="https://resend.com/domains" target="_blank" style="color: #ff6b35; font-weight: 600;">
              üåê Domains
            </a> - Verify your custom domain
          </li>
          <li style="margin-bottom: 8px;">
            <a href="https://resend.com/api-keys" target="_blank" style="color: #ff6b35; font-weight: 600;">
              üîë API Keys
            </a> - Manage API keys
          </li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    // Configuration Check
    async function checkConfig() {
      const apiKey = document.getElementById('apiKey').value.trim();
      const fromEmail = document.getElementById('fromEmail').value.trim();
      const statusDiv = document.getElementById('configStatus');
      
      if (!apiKey) {
        statusDiv.innerHTML = '<div class="status error">‚ö†Ô∏è Please enter your Resend API key</div>';
        return;
      }
      
      if (!fromEmail) {
        statusDiv.innerHTML = '<div class="status error">‚ö†Ô∏è Please enter a from email address</div>';
        return;
      }
      
      statusDiv.innerHTML = '<div class="status info">üîç Checking configuration...</div>';
      
      // Simple validation
      if (apiKey.startsWith('re_')) {
        let messages = ['‚úÖ API key format looks correct'];
        
        if (fromEmail === 'onboarding@resend.dev') {
          messages.push('‚úÖ Using Resend test email (no domain verification needed)');
        } else if (fromEmail.includes('@rpgcc.co.uk') || fromEmail.includes('@rpgcc.com')) {
          messages.push('‚ö†Ô∏è Using custom domain - make sure it\'s verified in Resend');
        }
        
        statusDiv.innerHTML = `<div class="status success">${messages.join('<br>')}</div>`;
      } else {
        statusDiv.innerHTML = '<div class="status error">‚ùå API key should start with "re_"</div>';
      }
    }
    
    // Send Test Email
    async function sendTestEmail() {
      const apiKey = document.getElementById('apiKey').value.trim();
      const fromEmail = document.getElementById('fromEmail').value.trim();
      const toEmail = document.getElementById('toEmail').value.trim();
      const toName = document.getElementById('toName').value.trim() || 'there';
      const statusDiv = document.getElementById('sendStatus');
      const sendBtn = document.getElementById('sendBtn');
      
      if (!apiKey || !fromEmail || !toEmail) {
        statusDiv.innerHTML = '<div class="status error">‚ö†Ô∏è Please fill in all required fields</div>';
        return;
      }
      
      sendBtn.disabled = true;
      statusDiv.innerHTML = '<div class="status info">üì§ Sending test email...</div>';
      
      try {
        const response = await fetch('https://api.resend.com/emails', {
          method: 'POST',
          mode: 'cors',
          headers: {
            'Authorization': `Bearer ${apiKey}`,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            from: `RPGCC Team Portal <${fromEmail}>`,
            to: [toEmail],
            subject: "üß™ Test Email from TORSOR Portal",
            html: `
              <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                <div style="background: #1a2b4a; color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0;">
                  <h1>‚úÖ Email Configuration Working!</h1>
                </div>
                <div style="background: #f5f5f5; padding: 30px;">
                  <p style="font-size: 16px;">Hi ${toName},</p>
                  <p style="font-size: 16px;">This is a test email from your TORSOR Skills Portal.</p>
                  <p style="font-size: 16px; margin-top: 20px;">
                    <strong>If you're seeing this, your Resend configuration is working perfectly! üéâ</strong>
                  </p>
                  <div style="background: white; padding: 20px; border-radius: 8px; margin-top: 20px;">
                    <h3 style="color: #1a2b4a; margin-top: 0;">Next Steps:</h3>
                    <ol style="color: #555; line-height: 2;">
                      <li>Add environment variables to Railway</li>
                      <li>Redeploy your application</li>
                      <li>Test invitation system</li>
                      <li>Invite your team members!</li>
                    </ol>
                  </div>
                </div>
                <div style="background: #1a2b4a; color: white; padding: 20px; text-align: center; border-radius: 0 0 10px 10px;">
                  <p style="margin: 0; font-size: 12px;">TORSOR Skills Portal ¬© 2025</p>
                </div>
              </div>
            `
          }),
        });
        
        if (response.ok) {
          const data = await response.json();
          statusDiv.innerHTML = `
            <div class="status success">
              ‚úÖ <strong>Email sent successfully!</strong><br>
              Message ID: ${data.id}<br><br>
              Check your inbox at <strong>${toEmail}</strong><br>
              (Don't forget to check spam folder!)
            </div>
          `;
        } else {
          const errorData = await response.json();
          statusDiv.innerHTML = `
            <div class="status error">
              ‚ùå <strong>Resend API Error (${response.status})</strong><br>
              ${errorData.message || 'Unknown error'}<br><br>
              <strong>Common fixes:</strong><br>
              ‚Ä¢ Check API key is correct<br>
              ‚Ä¢ Use onboarding@resend.dev for testing<br>
              ‚Ä¢ Verify domain in Resend dashboard
            </div>
          `;
        }
      } catch (error) {
        statusDiv.innerHTML = `
          <div class="status error">
            ‚ùå <strong>Network Error</strong><br>
            ${error.message}<br><br>
            Check your internet connection and CORS settings.
          </div>
        `;
      } finally {
        sendBtn.disabled = false;
      }
    }
    
    // Copy Environment Variables
    function copyToClipboard() {
      const text = `VITE_RESEND_API_KEY=re_gNeRqnEt_MxFb413pA2FZKFsCLD1XeBGC
VITE_FROM_EMAIL=onboarding@resend.dev
VITE_FROM_NAME=RPGCC Team Portal`;
      
      navigator.clipboard.writeText(text).then(() => {
        alert('‚úÖ Environment variables copied to clipboard!\n\nNow paste them into Railway dashboard.');
      }).catch(err => {
        alert('Failed to copy: ' + err);
      });
    }
  </script>
</body>
</html>

